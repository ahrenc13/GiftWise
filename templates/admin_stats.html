<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Stats - GiftWise Database Health</title>
    <link rel="stylesheet" href="/static/styles.css">
    <style>
        .stats-container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-card h3 {
            font-size: 14px;
            color: #666;
            margin: 0 0 8px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: bold;
            color: #333;
            margin: 0;
        }

        .stat-card .subtitle {
            font-size: 14px;
            color: #888;
            margin-top: 8px;
        }

        .retailer-breakdown {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .retailer-breakdown h2 {
            margin: 0 0 20px 0;
            font-size: 20px;
        }

        .retailer-bar {
            margin-bottom: 16px;
        }

        .retailer-bar-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .retailer-bar-fill {
            height: 24px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .top-brands {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .top-brands h2 {
            margin: 0 0 20px 0;
            font-size: 20px;
        }

        .brand-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .brand-item {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
        }

        .brand-item:last-child {
            border-bottom: none;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .refresh-info {
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .refresh-info strong {
            display: block;
            margin-bottom: 8px;
            color: #1e40af;
        }

        .status-good {
            color: #16a34a;
        }

        .status-warning {
            color: #ea580c;
        }

        .status-bad {
            color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="stats-container">
        <h1>Database Health Dashboard</h1>

        {% if error %}
            <div class="error-message">
                <strong>Error:</strong> {{ error }}
            </div>
        {% elif stats %}
            <!-- Last Refresh Info -->
            <div class="refresh-info">
                <strong>Last Refresh:</strong>
                {{ stats.last_refresh }}
                <p style="margin: 8px 0 0 0; font-size: 14px; color: #64748b;">
                    Database is automatically refreshed daily at 2:00 AM UTC via GitHub Actions
                </p>
            </div>

            <!-- Key Metrics Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Total Products</h3>
                    <div class="value {{ 'status-good' if stats.total_products > 100 else 'status-warning' if stats.total_products > 0 else 'status-bad' }}">
                        {{ stats.total_products }}
                    </div>
                    <div class="subtitle">Active & in-stock</div>
                </div>

                <div class="stat-card">
                    <h3>Added Today</h3>
                    <div class="value">{{ stats.added_today }}</div>
                    <div class="subtitle">Last 24 hours</div>
                </div>

                <div class="stat-card">
                    <h3>Stale Products</h3>
                    <div class="value {{ 'status-warning' if stats.stale_count > 50 else 'status-good' }}">
                        {{ stats.stale_count }}
                    </div>
                    <div class="subtitle">Not checked in 7+ days</div>
                </div>

                <div class="stat-card">
                    <h3>Unique Brands</h3>
                    <div class="value">{{ stats.top_brands|length }}</div>
                    <div class="subtitle">Top brands tracked</div>
                </div>
            </div>

            <!-- Retailer Breakdown -->
            <div class="retailer-breakdown">
                <h2>Products by Retailer</h2>
                {% set max_count = stats.by_retailer.values()|list|max if stats.by_retailer else 1 %}
                {% for retailer, count in stats.by_retailer.items() %}
                    <div class="retailer-bar">
                        <div class="retailer-bar-label">
                            <span><strong>{{ retailer|capitalize }}</strong></span>
                            <span>{{ count }} products</span>
                        </div>
                        <div style="background: #f3f4f6; border-radius: 4px; overflow: hidden;">
                            <div class="retailer-bar-fill" style="width: {{ (count / max_count * 100)|round(1) }}%;"></div>
                        </div>
                    </div>
                {% endfor %}

                {% if not stats.by_retailer %}
                    <p style="color: #888; text-align: center; padding: 20px;">
                        No products in database yet. Run <code>python products/refresh.py</code> to populate.
                    </p>
                {% endif %}
            </div>

            <!-- Top Brands -->
            {% if stats.top_brands %}
                <div class="top-brands">
                    <h2>Top Brands</h2>
                    <ul class="brand-list">
                        {% for brand_data in stats.top_brands[:10] %}
                            <li class="brand-item">
                                <span><strong>{{ brand_data.brand }}</strong></span>
                                <span>{{ brand_data.count }} products</span>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}

            <!-- System Info -->
            <div class="refresh-info" style="margin-top: 30px; background: #f9fafb; border-left-color: #6b7280;">
                <strong>System Information</strong>
                <p style="margin: 8px 0 0 0; font-size: 14px; color: #64748b;">
                    Database Location: <code>/home/user/GiftWise/data/products.db</code><br>
                    Refresh Schedule: Daily at 2:00 AM UTC<br>
                    Stale Threshold: 7 days<br>
                    Max Products per Retailer: 500
                </p>
            </div>

        {% else %}
            <div class="error-message">
                No stats available. Database may not be initialized yet.
            </div>
        {% endif %}

        <!-- Navigation -->
        <div style="margin-top: 40px; text-align: center;">
            <a href="/" style="color: #6366f1; text-decoration: none; font-weight: 500;">‚Üê Back to Home</a>
            &nbsp;|&nbsp;
            <a href="/usage" style="color: #6366f1; text-decoration: none; font-weight: 500;">API Usage Dashboard</a>
        </div>
    </div>

    <script>
        // Auto-refresh every 60 seconds
        setTimeout(() => {
            window.location.reload();
        }, 60000);
    </script>
</body>
</html>
