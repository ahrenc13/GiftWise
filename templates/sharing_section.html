<!-- SHARING SECTION - INSERT AFTER PAGE TITLE -->
<div class="sharing-section">
    <div class="share-card">
        <h3>üíù Love Your Recommendations?</h3>
        <p>Share the gift with friends (and earn rewards!)</p>
        
        <div class="share-buttons">
            <button class="share-btn share-image" onclick="shareImage()">
                üì∏ Share as Image
            </button>
            
            <button class="share-btn share-twitter" onclick="shareTwitter()">
                üê¶ Share on Twitter
            </button>
            
            <button class="share-btn share-link" onclick="copyLink()">
                üîó Copy Link
            </button>
        </div>
        
        <div class="referral-box">
            <div class="referral-code">
                <span class="label">Your Referral Code:</span>
                <span class="code" id="referral-code">{{ user.referral_code }}</span>
                <button class="copy-code-btn" onclick="copyReferralCode()">Copy</button>
            </div>
            <p class="referral-reward">
                üéÅ Friends get 25% off ‚Ä¢ You get 1 month free per friend!
            </p>
        </div>
    </div>
</div>

<style>
.sharing-section {
    margin: 40px auto;
    max-width: 800px;
}

.share-card {
    background: linear-gradient(135deg, #fff1f2, #fecdd3);
    border: 2px solid #f43f5e;
    border-radius: 20px;
    padding: 40px;
    text-align: center;
}

.share-card h3 {
    font-size: 28px;
    color: #be123c;
    margin-bottom: 12px;
}

.share-card > p {
    color: #6b7280;
    margin-bottom: 30px;
}

.share-buttons {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 30px;
}

.share-btn {
    padding: 14px 28px;
    border: none;
    border-radius: 12px;
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
}

.share-image {
    background: linear-gradient(135deg, #f43f5e, #be123c);
    color: white;
}

.share-image:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(190, 18, 60, 0.3);
}

.share-twitter {
    background: #1da1f2;
    color: white;
}

.share-twitter:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(29, 161, 242, 0.3);
}

.share-link {
    background: #10b981;
    color: white;
}

.share-link:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(16, 185, 129, 0.3);
}

.referral-box {
    background: white;
    padding: 25px;
    border-radius: 16px;
    margin-top: 25px;
}

.referral-code {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    margin-bottom: 15px;
    flex-wrap: wrap;
}

.referral-code .label {
    font-size: 14px;
    color: #6b7280;
    font-weight: 600;
}

.referral-code .code {
    font-size: 24px;
    font-weight: 800;
    color: #be123c;
    font-family: monospace;
    background: #fecdd3;
    padding: 8px 20px;
    border-radius: 8px;
}

.copy-code-btn {
    padding: 8px 16px;
    background: #f43f5e;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}

.copy-code-btn:hover {
    background: #be123c;
}

.referral-reward {
    font-size: 14px;
    color: #374151;
    margin: 0;
}

@media (max-width: 768px) {
    .share-card {
        padding: 24px;
    }
    
    .share-buttons {
        flex-direction: column;
    }
    
    .share-btn {
        width: 100%;
    }
    
    .referral-code {
        flex-direction: column;
    }
}
</style>

<script>
function shareImage() {
    // Generate and download shareable image
    fetch('/api/generate-share-image', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}
    })
    .then(response => response.blob())
    .then(blob => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'my-valentine-gifts.png';
        a.click();
        
        // Show success message
        alert('üì∏ Image downloaded! Share it on Instagram Stories or anywhere you like üíù');
    })
    .catch(error => {
        console.error('Error generating image:', error);
        alert('Oops! Could not generate image. Try again?');
    });
}

function shareTwitter() {
    const text = "Just found the perfect Valentine's gift with AI! üíù No more guessing what they want. ";
    const url = "https://giftwise.fit?ref={{ user.referral_code }}";
    const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
    window.open(twitterUrl, '_blank', 'width=550,height=420');
}

function copyLink() {
    const link = "https://giftwise.fit?ref={{ user.referral_code }}";
    navigator.clipboard.writeText(link).then(() => {
        alert('üîó Link copied! Share it with friends to give them 25% off üíù');
    }).catch(() => {
        // Fallback for older browsers
        const input = document.createElement('input');
        input.value = link;
        document.body.appendChild(input);
        input.select();
        document.execCommand('copy');
        document.body.removeChild(input);
        alert('üîó Link copied!');
    });
}

function copyReferralCode() {
    const code = document.getElementById('referral-code').textContent;
    navigator.clipboard.writeText(code).then(() => {
        const btn = event.target;
        btn.textContent = '‚úì Copied!';
        setTimeout(() => {
            btn.textContent = 'Copy';
        }, 2000);
    });
}
</script>
